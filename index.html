<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>

</head>

<body>
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <svg class="bi me-2" width="40" height="32">
                    <use xlink:href="#bootstrap"></use>
                </svg>
                <span class="fs-4">Simple header</span>
            </a>

            <ul class="nav nav-pills">

                <li class="nav-item"><a href="#" onclick="keke();" class="nav-link">go</a></li>
                <p>
                    <span onclick="_counter--;keke()">left</span>
                    <span class="_c"></span>
                    <span onclick="_counter++;keke()">right</span>
                </p>
            </ul>
        </header>
        <div class="row">
            <textarea>жаваскрипт жава кафедра драма</textarea>
        </div>
        <div class="fff-container">

        </div>
    </div>
    <style>
        .fff--span {
            z-index: 999;
            padding: 10px;
            background-color: gray;
            margin: 4px;
        }

        .ccol {
            width: 25px;
            height: 25px;
            border: 1px solid black;
        }

        .fff--spans {
            display: flex;
            flex-wrap: wrap;
        }

        .fff {
            border: 1px solid blue;
            padding: 10px;
            display: inline-flex;
            width: 400px;
            display: flex;
            flex-wrap: wrap;
        }

        .fff--select {
            border: 0px;
        }

        .fff--select:focus-visible {
            border: 0px !important;
            outline: none;
        }

        .fff--x {
            cursor: pointer;
        }

        .fff--list {
            display: none;
            height: 300px;
            overflow: auto;
        }

        .fff--list {
            width: 400px;
            border: 1px solid black;
        }
    </style>
    <script>
        class node {
            id = "";
            value = '';
            childrens = [];
            vis = false;
            parent = [];
        }

        let _counter = 0;

        let arr = document.querySelector("textarea").value.split(" ")
        let pole = [
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]
        ];
        let keke = () => {
            arr = document.querySelector("textarea").value.split(" ")
            let tree = [];
            let stack = [];
            let counter = 1;
            let chid = 1;
            let getTree = (str) => {
                str = str.split("")
                stack = [];
                for (let i = 0; i <= str.length - 1; i++) {
                    let el = new node();
                    el.id = counter;
                    el.chid = chid++;
                    el.value = str[i];
                    if (stack.length) {
                        stack[stack.length - 1].childrens.push(el);
                        el.parent = stack[stack.length - 1];
                    }
                    stack.push(el);
                }
                tree.push(stack[0]);
            };
            arr.forEach((item) => {
                getTree(item);
                counter++
            });

            let deep = (node) => {
                let cNode = node;
                let deep2 = (node) => {
                    if (node.id !== cNode.id && node.value === cNode.value) {
                        cNode.vis = true;
                        cNode.childrens = [...cNode.childrens, node];
                        node.childrens = [...node.childrens, cNode];

                    }
                    node.childrens.forEach((item) => {
                        if (!item.vis) {
                            deep2(item);
                        }
                    })
                }
                tree.forEach((item) => {
                    if (item !== node) {
                        deep2(item);
                    }
                });
                node.childrens.forEach((item) => {
                    if (!item.vis) {
                        deep(item);
                    }
                })
            }

            tree.forEach((item) => {
                deep(item);
            });

            let prints = [];
            let poles = [];
            let cPole = JSON.parse(JSON.stringify(pole));
            let kek = false;
            let kek2 = true;
            let cWords = [];
            let ka = [];
            let kac = 0;
            let col = false;
            let kkk2 = [];
            let kkk
            let cpoletypes = JSON.parse(JSON.stringify(pole));
            let _check = false;
            let print = (type, word, start, r = false, p = true) => {

                if (prints.includes(word)) {
                    return
                }
                prints.push(word);
                if (p) {
                    if (!word.value) {
                        return
                    }
                    if (cPole[start[0]][start[1]] !== "" && cPole[start[0]][start[1]] !== word.value) {
                        col = true;
                    }
                    if (cPole[start[0]][start[1]] == word.value && cpoletypes[start[0]][start[1]] == type) {
                        //   _check = true;
                    }
                    cPole[start[0]][start[1]] = word.value;

                    cpoletypes[start[0]][start[1]] = type;
                }
                let s, t;
                if (!prints.includes(word.parent) && word.parent) {
                    t = (word.parent.id === word.id) ? type : (type === 1) ? 2 : 1;
                    s = (t === 1) ? [start[0] - 1, start[1]] : [start[0], start[1] - 1];
                    print(t, word.parent, s, true);
                }
                for (let i = 0; i <= word.childrens.length - 1; i++) {
                    let item = word.childrens[i];
                    t = (item.id === word.id) ? type : (type === 1) ? 2 : 1;
                    s = (t === 1) ? [start[0] + 1, start[1]] : [start[0], start[1] + 1];
                    if (item.id !== word.id) {
                        s = (t === 1) ? [start[0], start[1]] : [start[0], start[1]];
                    }
                    print(t, item, s, false, item.id == word.id);
                    if (item.id !== word.id) {
                        if (!cWords[word.id]) { cWords[word.id] = []; }
                        if (!kkk && cWords[word.id].map((c) => c.id).includes(item.id)) {
                            kkk = cWords[word.id].find((c) => c.id === item.id)
                            kkk = kkk2.find((c) => c.item === kkk).i;
                            kek = true;
                        }
                        else {
                            cWords[word.id].push(item);
                            kkk2.push({ item, i })
                        }
                        if (word.childrens.length > 2) {
                            //todo
                        }
                    }
                }
                if (kkk) {
                    word.childrens = word.childrens.filter((c, i) => i !== kkk);
                }

            }

            let ee = 0;
            poles = [];
            let qq = 0
            while (((kek || ee == 0)) && ee < 100) {
                kek2 = false;
                ee++;
                kek = false;
                prints = []
                kkk = false;
                kkk2 = [];
                cPole = JSON.parse(JSON.stringify(pole));
                cWords = [];
                col = false;
                _check = false;

                cpoletypes = JSON.parse(JSON.stringify(pole));
                kac = ka.length;
                if (qq === tree.length - 1) {
                    qq = 0
                }
                print(1, tree[qq++], [10, 10]);
                if (_check) {
                    continue;
                }
                poles.push(cPole);
            }
            console.log(poles.length)
            let html = '';
            let htmlBuild = (pole) => {
                for (let i = 0; i <= pole.length - 1; i++) {
                    html += `<div class="row">`
                    for (let j = 0; j <= pole[i].length - 1; j++) {
                        html += `<div class="ccol">${pole[i][j]}</div>`;
                    }
                    html += `</div>`
                }
                document.querySelector("._c").innerHTML = `${_counter}/${poles.length - 1}`;
            }
            function getRandomInt(max) {
                return Math.floor(Math.random() * max);
            }

            htmlBuild(poles[_counter])
            document.querySelector(".fff-container").innerHTML = html;

        }
    </script>

</body>

</html>